"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9987],{5020:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>u,contentTitle:()=>p,default:()=>f,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var t=s(7366),i=(s(9496),s(9613)),r=s(9760);const o="/* eslint-disable @typescript-eslint/no-explicit-any */\nimport axios from 'axios'\nimport type {\n  AxiosError,\n  AxiosInstance,\n  AxiosProgressEvent,\n  AxiosRequestConfig,\n  AxiosResponse,\n} from 'axios'\n\n// \u5c01\u88c5\u540e\u7aef\u8fd4\u56de\u503c\u7c7b\u578b\nexport type ResponseData<T> = {\n  code: number\n  msg: string\n  data: T\n}\n\nexport function downloadFile(res: Blob, filename: string) {\n  const blobUrl = window.URL.createObjectURL(new Blob([res]))\n  const a = document.createElement('a')\n  a.style.display = 'none'\n  a.href = blobUrl\n  a.download = filename\n  document.body.appendChild(a)\n  a.click()\n  document.body.removeChild(a)\n  window.URL.revokeObjectURL(blobUrl) // \u91ca\u653eblob\u5bf9\u8c61\n}\n\n/**\n * \u5c06\u6587\u4ef6\u5927\u5c0f\u6570\u5b57\u4f7f\u7528\u5408\u9002\u7684\u5355\u4f4d\u683c\u5f0f\u5316\u3002\n * @param filesize  \u5b57\u8282\u5927\u5c0f\n * @param decimalPlaces  \u5c0f\u6570\u4f4d\u6570\n * @returns\n */\nexport function filesizeFormatter(filesize: number, decimalPlaces = 2) {\n  const sizedict = {\n    b: 1,\n    kb: 1 << 10,\n    mb: 1 << 20,\n    gb: 1 << 30,\n    tb: Math.pow(1024, 4),\n    pb: Math.pow(1024, 5),\n  }\n  type SizeUnit = keyof typeof sizedict\n  let unit: Uppercase<SizeUnit> = 'B'\n  if (filesize >= sizedict.pb) {\n    unit = 'PB'\n  } else if (filesize >= sizedict.tb) {\n    unit = 'TB'\n  } else if (filesize >= sizedict.gb) {\n    unit = 'GB'\n  } else if (filesize >= sizedict.mb) {\n    unit = 'MB'\n  } else if (filesize >= sizedict.kb) {\n    unit = 'KB'\n  } else {\n    unit = 'B'\n  }\n  return (\n    (filesize / sizedict[unit.toLowerCase() as SizeUnit]).toFixed(\n      decimalPlaces\n    ) + unit\n  )\n}\n/**\n * \u683c\u5f0f\u5316\u4e0b\u8f7d\u8fdb\u5ea6log\u4fe1\u606f\n * @param progressEvent\n * @returns\n */\nexport function formatProgressMsg(progressEvent: AxiosProgressEvent) {\n  return `\u4e0b\u8f7d\u8fdb\u5ea6:${((progressEvent.progress ?? 0) * 100).toPrecision(\n    4\n  )}% Speed:${filesizeFormatter(progressEvent.rate ?? 0)}/s`\n}\n\n/**\n * \u901a\u7528\u5904\u7406\u4e0b\u8f7d\u8fdb\u5ea6\u7684\u51fd\u6570\n * @param progressEvent\n */\nexport function handleDownloadProgress(progressEvent: AxiosProgressEvent) {\n  const progressMsg = formatProgressMsg(progressEvent)\n  console.log(progressMsg)\n}\n\nexport class Request {\n  // axios \u5b9e\u4f8b\n  private instance: AxiosInstance\n  // \u9ed8\u8ba4\u914d\u7f6e\n  private baseConfig = {\n    baseURL: '/api',\n    timeout: 5000,\n    withCredentials: true,\n  }\n\n  constructor(config: AxiosRequestConfig) {\n    this.instance = axios.create(Object.assign(this.baseConfig, config))\n\n    // \u8bf7\u6c42\u62e6\u622a\u5668\n    this.instance.interceptors.request.use(\n      function (config) {\n        // \u8fd9\u91cc\u53ef\u4ee5\u8bbe\u7f6e\u8bf7\u6c42\u4fe1\u606f\uff0c\u6bd4\u5982\u5728\u5934\u90e8\u6dfb\u52a0\u767b\u5f55\u7684token\n        // const loginStorage = getLocalstorage('userInfo') as LoginRes | null\n        // // \u53d6\u5f97token\u4ee5\u540e\u8fdb\u884c\u6dfb\u52a0\n        // if (loginStorage) {\n        //   // \u6dfb\u52a0Authorization\u8bf7\u6c42\u5934\u7528\u4e8e\u767b\u5f55\u8ba4\u8bc1\n        //   const { token } = loginStorage\n        //   if (token && config.headers) {\n        //     ;(config.headers as { [key: string]: unknown })['x-token'] = token\n        //   }\n        // }\n        return config\n      },\n      function (error: AxiosError) {\n        // \u8bf7\u6c42\u9519\u8bef\uff0c\u8fd9\u91cc\u53ef\u4ee5\u7528\u5168\u5c40\u63d0\u793a\u6846\u8fdb\u884c\u63d0\u793a\n        return Promise.reject(error)\n      }\n    )\n\n    // \u6dfb\u52a0\u54cd\u5e94\u62e6\u622a\u5668\n    this.instance.interceptors.response.use(\n      function (response) {\n        // \u5bf9\u54cd\u5e94\u6570\u636e\u505a\u70b9\u4ec0\u4e48\n        console.log(\n          `%c${response.config.url}`,\n          'background:#2d8cf0; padding: 2px; border-radius: 4px;color: #fff;',\n          response.data,\n          {\n            response,\n          }\n        )\n        if (response.request.responseType === 'blob') {\n          return response\n        }\n        return response.data\n      },\n      // \u4efb\u4f55\u8d85\u8fc72xx\u8303\u56f4\u7684\u72b6\u6001\u7801\uff0c\u4f1a\u89e6\u53d1\u8fd9\u4e2a\u51fd\u6570\n      // \u8fd9\u91cc\u7528\u6765\u5904\u7406http\u5e38\u89c1\u9519\u8bef\uff0c\u8fdb\u884c\u5168\u5c40\u63d0\u793a\n      function (error) {\n        let message = ''\n        switch (error.response.status) {\n          case 400:\n            message = '\u8bf7\u6c42\u9519\u8bef(400)'\n            break\n          case 401:\n            message = '\u672a\u6388\u6743\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55(401)'\n            // \u8fd9\u91cc\u53ef\u4ee5\u505a\u6e05\u7a7astorage\u5e76\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u7684\u64cd\u4f5c\n            // delLocalStorage('userInfo')\n            // window.location.reload()\n            break\n          case 403:\n            message = '\u62d2\u7edd\u8bbf\u95ee(403)'\n            break\n          case 404:\n            message = '\u8bf7\u6c42\u51fa\u9519(404)'\n            break\n          case 408:\n            message = '\u8bf7\u6c42\u8d85\u65f6(408)'\n            break\n          case 500:\n            message = '\u670d\u52a1\u5668\u9519\u8bef(500)'\n            break\n          case 501:\n            message = '\u670d\u52a1\u672a\u5b9e\u73b0(501)'\n            break\n          case 502:\n            message = '\u7f51\u7edc\u9519\u8bef(502)'\n            break\n          case 503:\n            message = '\u670d\u52a1\u4e0d\u53ef\u7528(503)'\n            break\n          case 504:\n            message = '\u7f51\u7edc\u8d85\u65f6(504)'\n            break\n          case 505:\n            message = 'HTTP\u7248\u672c\u4e0d\u53d7\u652f\u6301(505)'\n            break\n          default:\n            message = `\u8fde\u63a5\u51fa\u9519(${error.response.status})!`\n        }\n\n        // \u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5f39\u51fa\u5168\u5c40\u62a5\u9519\u63d0\u793a\n        // notification.error({\n        //   message: message,\n        //   description: error?.response?.data?.msg ?? '\u670d\u52a1\u7aef\u5f02\u5e38',\n        // })\n      }\n    )\n  }\n\n  // \u5b9a\u4e49\u6838\u5fc3\u8bf7\u6c42\n  public request(config: AxiosRequestConfig): Promise<AxiosResponse> {\n    return this.instance.request(config)\n  }\n\n  // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n  public get<T = any>(\n    url: string,\n    config?: AxiosRequestConfig\n  ): Promise<ResponseData<T>> {\n    return this.instance.get(url, config)\n  }\n\n  // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n  public post<T = any>(\n    url: string,\n    // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n    data?: any,\n    config?: AxiosRequestConfig\n  ): Promise<ResponseData<T>> {\n    return this.instance.post(url, data, config)\n  }\n\n  // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n  public put<T = any>(\n    url: string,\n    // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n    data?: any,\n    config?: AxiosRequestConfig\n  ): Promise<ResponseData<T>> {\n    return this.instance.put(url, data, config)\n  }\n\n  // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n  public delete<T = any>(\n    url: string,\n    config?: AxiosRequestConfig\n  ): Promise<ResponseData<T>> {\n    return this.instance.delete(url, config)\n  }\n}\n\nexport default new Request({})\n",a={nav:{title:"\u4ee3\u7801\u7247\u6bb5",order:1},group:{title:"request\u5c01\u88c5",order:2},toc:"content",tocDepth:3},p="request \u5c01\u88c5",c={unversionedId:"snippets/JavaScript/request",id:"snippets/JavaScript/request",title:"request \u5c01\u88c5",description:"axios \u5c01\u88c5",source:"@site/docs/snippets/JavaScript/request.mdx",sourceDirName:"snippets/JavaScript",slug:"/snippets/JavaScript/request",permalink:"/website/docs/snippets/JavaScript/request",draft:!1,tags:[],version:"current",lastUpdatedAt:1689400265,formattedLastUpdatedAt:"Jul 15, 2023",frontMatter:{nav:{title:"\u4ee3\u7801\u7247\u6bb5",order:1},group:{title:"request\u5c01\u88c5",order:2},toc:"content",tocDepth:3},sidebar:"snippetsSidebar",previous:{title:"jsutils \u5c01\u88c5",permalink:"/website/docs/snippets/JavaScript/jsutil"},next:{title:"\u4f7f\u7528 scss \u5b9e\u73b0 tailwind \u7684\u6837\u5f0f",permalink:"/website/docs/snippets/css/tailwind"}},u={},l=[{value:"axios \u5c01\u88c5",id:"axios-\u5c01\u88c5",level:2},{value:"uniapp request \u5c01\u88c5",id:"uniapp-request-\u5c01\u88c5",level:2}],g={toc:l},d="wrapper";function f(n){let{components:e,...s}=n;return(0,i.kt)(d,(0,t.Z)({},g,s,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"request-\u5c01\u88c5"},"request \u5c01\u88c5"),(0,i.kt)("h2",{id:"axios-\u5c01\u88c5"},"axios \u5c01\u88c5"),(0,i.kt)("p",null,"\u5c01\u88c5 axios \u7684\u4e3b\u8981\u4f5c\u7528\uff0c\u6211\u8ba4\u4e3a\u4f53\u73b0\u5728\u56e2\u961f\u5408\u4f5c\u7684\u65f6\u5019\uff0c\u80fd\u591f\u7edf\u4e00\u4ee3\u7801\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u5176\u6b21\u662f\u5728 axios \u4e0a\u5305\u4e86\u4e00\u5c42\uff0c\u5982\u679c\u4ee5\u540e\u4e0d\u7528 axios \u4e86\uff0c\u66f4\u5bb9\u6613\u66ff\u6362\uff08\u8fd9\u662f\u4f2a\u9700\u6c42\u4e86\uff0caxios \u5c31\u7b97\u4e0d\u7ef4\u62a4\u4e86\u4e5f\u80fd\u6491\u51e0\u5e74\uff09",(0,i.kt)("br",{parentName:"p"}),"\n","\u5728 ts \u4e0b\u5c01\u88c5\u8fd8\u6709\u4e00\u4e2a\u597d\u5904\u662f\u63d0\u4f9b\u7c7b\u578b\u63d0\u793a\uff0c\u4f46\u662f axios \u672c\u6765\u5c31\u662f ts \u5199\u7684\uff0c\u672c\u8eab\u5c31\u652f\u6301\u7c7b\u578b\u63d0\u793a\u3002"),(0,i.kt)("p",null,"\u6240\u4ee5\uff0c\u6211\u8ba4\u4e3a\u5728\u6ca1\u6709\u56e2\u961f\u5408\u4f5c\u7684\u60c5\u51b5\u4e0b\uff0c\u6ca1\u5fc5\u8981\u5c01\u88c5 axios\u3002\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f8b\u7528\u5b98\u65b9\u7684\u62e6\u622a\u5668\u5c31\u80fd\u5b9e\u73b0\u5927\u90e8\u5206\u529f\u80fd\u4e86\u3002"),(0,i.kt)("p",null,"\u56e0\u4e3a\u6211\u89c9\u5f97\u62e6\u622a\u5668\u5c31\u80fd\u5b9e\u73b0\u9700\u6c42\u4e86\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7c7b\u7684\u5c01\u88c5\uff0c\u4e5f\u53ea\u662f\u7b80\u5355\u5305\u4e00\u5c42\uff0c\u52a0\u4e0a\u7c7b\u578b\u63d0\u793a\u800c\u5df2\u3002\u5bf9\u4e8e axios \u7684\u4f7f\u7528\u51e0\u4e4e\u6ca1\u6709\u5f71\u54cd\uff0c\u53ea\u662f\u9650\u5236\u53ea\u662f\u7528 4 \u79cd\u56fa\u5b9a\u7684\u8bf7\u6c42\u3002\u3002\u3002"),(0,i.kt)(r.Z,{language:"ts",mdxType:"CodeBlock"},o),(0,i.kt)("h2",{id:"uniapp-request-\u5c01\u88c5"},"uniapp request \u5c01\u88c5"),(0,i.kt)("p",null,"uniapp \u7684 request\uff0c\u662f\u56de\u8c03\u51fd\u6570\u7684\u5f62\u5f0f\u3002 \u5982\u679c\u4e0d\u8fdb\u884c\u5c01\u88c5\u4f7f\u7528\uff0c\u5f88\u5bb9\u6613\u9020\u6210\u56de\u8c03\u5730\u72f1\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u56e0\u4e3a uniapp \u652f\u6301 promise \u548c async await\uff0c\u56e0\u4e3a\u6211\u8981\u540c\u65f6\u7ef4\u62a4\u5c0f\u7a0b\u5e8f\u548c pc \u7aef\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u5c01\u88c5\u6210\u7edf\u4e00\u7684 async \u51fd\u6570\u6bd4\u8f83\u5408\u9002\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u8fd9\u6837\u57fa\u672c\u4e0a\u53ef\u4ee5\u4ece pc \u7aef\u7684\u63a5\u53e3\u7c98\u8d34\u5185\u5bb9\u5230\u5c0f\u7a0b\u5e8f\u3002\u3002\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"// \u5c01\u88c5\u540e\u7aef\u8fd4\u56de\u503c\u7c7b\u578b\nexport type ResponseData<T> = {\n  code: string\n  msg: string\n  data: T\n}\n// \u5b50\u5f53\u4ee5\u8bf7\u6c42\u53c2\u6570\nexport interface CustomRequestOptions extends Partial<UniApp.RequestOptions> {\n  baseURL?: string\n  responseInterceptors?: (res: any) => any\n}\nexport class Request {\n  private baseURL = 'xxx/xxx'\n\n  // \u9ed8\u8ba4\u914d\u7f6e\n  private baseConfig = {\n    // timeout: 5000,\n    // withCredentials: true,\n  }\n  private baseHeader = {\n    Authorization: 'xxx',\n  }\n  private _config: CustomRequestOptions\n\n  // \u8986\u76d6\u9ed8\u8ba4\u914d\u7f6e\n  constructor(config: CustomRequestOptions) {\n    this._config = Object.assign(this.baseConfig, config)\n    if (config.baseURL) {\n      this.baseURL = config.baseURL\n    }\n    if (config.responseInterceptors) {\n      this.responseInterceptors = config.responseInterceptors\n    }\n  }\n\n  // \u8fd4\u56defalse\u8868\u793a\u4e0d\u8fdb\u884c\u8bf7\u6c42\n  private requestInterceptors(config: UniApp.RequestOptions): boolean {\n    return true\n  }\n\n  private responseInterceptors(\n    res: UniApp.RequestSuccessCallbackResult\n  ): unknown {\n    const data = res.data as ResponseData<any>\n    if (data?.code.startsWith('s')) {\n      uni.showToast({\n        title: data.msg,\n      })\n    } else {\n      return null\n    }\n    return res.data\n  }\n  // \u5b9a\u4e49\u6838\u5fc3\u8bf7\u6c42\n  public async request(config: UniApp.RequestOptions): Promise<any> {\n    //   \u62e6\u622a\u5668\u62e6\u622a\u65f6\uff0c\u4e0d\u53d1\u751f\u8bf7\u6c42\n    if (!this.requestInterceptors(config)) {\n      return\n    }\n    return new Promise((resolve, reject) => {\n      uni.request({\n        ...config,\n        url: encodeURI(config.url),\n        header: {\n          ...this.baseHeader,\n          ...config.header,\n        },\n        success: (res) => {\n          const data = this.responseInterceptors(res)\n          if (data) {\n            return resolve(data)\n          }\n        },\n        fail: (res) => {\n          return reject(res)\n        },\n      })\n    })\n  }\n\n  public async get<T = any>(\n    url: string,\n    config?: Omit<UniApp.RequestOptions, 'url'>\n  ): Promise<ResponseData<T>> {\n    return this.request({\n      url: this.baseURL + url,\n      method: 'GET',\n      ...config,\n    })\n  }\n\n  public async post<T = any>(\n    url: string,\n    data?: any,\n    config?: UniApp.RequestOptions\n  ): Promise<ResponseData<T>> {\n    return this.request({\n      url: this.baseURL + url,\n      method: 'POST',\n      data: data,\n      ...config,\n    })\n  }\n}\n\nexport default new Request({})\nexport const requstOrigin = new Request({\n  baseURL: '',\n  responseInterceptors(res) {\n    const data = res.data as ResponseData<any>\n    if (data?.code.startsWith('s')) {\n      uni.showToast({\n        title: data.msg,\n      })\n    } else {\n      return null\n    }\n    //   \u8fd9\u91cc\u5c31\u4e0d\u5bf9getUserPermission\u5355\u72ec\u5224\u65ad\u4e86\n    //   config.url.includes('getUserPermission')\n    return res\n  },\n})\n")))}f.isMDXComponent=!0}}]);